# Supabase Database Setup

Run the following SQL queries in your Supabase Project's [SQL Editor](https://supabase.com/dashboard/project/_/sql).

## 1. Create `chat_sessions` Table

Stores metadata about each chat session.

```sql
create table if not exists chat_sessions (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  user_summary text
);

-- Enable Row Level Security (RLS)
alter table chat_sessions enable row level security;

-- Policy: Allow anonymous insert (for public chatbot users)
create policy "Allow anonymous insert" on chat_sessions for insert with check (true);
create policy "Allow select" on chat_sessions for select using (true);
```

## 2. Create `messages` Table

Stores individual messages within a session.

```sql
create table if not exists messages (
  id bigint generated by default as identity primary key,
  session_id uuid references chat_sessions(id) not null,
  role text not null check (role in ('user', 'assistant', 'system')),
  content text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Enable RLS
alter table messages enable row level security;

-- Policy: Allow anonymous insert
create policy "Allow anonymous insert" on messages for insert with check (true);
create policy "Allow select" on messages for select using (true);

-- Index for performance
create index messages_session_id_idx on messages(session_id);
```

## 3. Create `leads` Table

Stores extracted contact information.

```sql
create table if not exists leads (
  id bigint generated by default as identity primary key,
  contact_info text,
  interest_category text,
  source_session_id uuid references chat_sessions(id),
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Enable RLS
alter table leads enable row level security;

-- Policy: Allow anonymous insert
create policy "Allow anonymous insert" on leads for insert with check (true);
create policy "Allow select" on leads for select using (true);
```
